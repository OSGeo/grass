---
# Author: Ivan Mincik, ivan.mincik@gmail.com (linux)
#         Rainer M. Krug, Rainer@krugs.de (osx)

os: linux
dist: jammy
language: c
cache: ccache

# safelist
branches:
  only:
    - main
    - releasebranch*

jobs:
  include:
    - os: linux
      compiler: gcc
      env: CC=gcc CXX=g++

    - os: linux
      compiler: clang
      env: CC=clang CXX=clang++

env:
  global:
    - CFLAGS="-Werror=implicit-function-declaration"
    - CXXFLAGS="-std=c++17"
    - GRASS_EXTRA_CFLAGS="-Werror -fPIC -Wfatal-errors"
    - GRASS_EXTRA_CXXFLAGS="-Werror -fPIC -Wfatal-errors"

before_install:
  - pyenv root
  - which pyenv && pyenv versions
  - which python
  - pip install uv --upgrade
  - ./.travis/$TRAVIS_OS_NAME.before_install.sh

install:
  - pip install uv
  - uv python list
  - uv python find
  - uv python find --system
  - ./.travis/$TRAVIS_OS_NAME.install.sh
  # - pyenv install 3.9
  - uv python install 3.9
  - which python

before_script:
  - which python
  - uv python list
  - uv python find
  - uv python find --system
  - uv python dir
  - uv python dir --bin
  - python --version
  # see https://github.com/astral-sh/uv/issues/6265

script:
  - ./.travis/$TRAVIS_OS_NAME.script.sh
