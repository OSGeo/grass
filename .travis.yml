---
# Author: Ivan Mincik, ivan.mincik@gmail.com (linux)
#         Rainer M. Krug, Rainer@krugs.de (osx)

os: linux
dist: jammy
language: c
cache: ccache

# safelist
branches:
  only:
    - main
    - releasebranch*

jobs:
  include:
    - os: linux
      compiler: gcc
      env: CC=gcc CXX=g++

    - os: linux
      compiler: clang
      env: CC=clang CXX=clang++

env:
  global:
    - CFLAGS="-Werror=implicit-function-declaration"
    - CXXFLAGS="-std=c++17"
    - GRASS_EXTRA_CFLAGS="-Werror -fPIC -Wfatal-errors"
    - GRASS_EXTRA_CXXFLAGS="-Werror -fPIC -Wfatal-errors"

before_install:
  - pyenv
  - pyenv --version
  - pyenv version-origin
  - pyenv version-name
  - pyenv version-file
  - pyenv version
  - pyenv shell
  - pyenv prefix
  - pyenv shims
  - python --version
  - python --version -VV
  - pyenv root
  - which pyenv && pyenv versions
  - which python
  - ls -la /etc/alternatives
  - ls -la /opt/pyenv/
  - ls -la /opt/pyenv/shims
  - cat /opt/pyenv/version
  - ls -la /opt/python
  - ls -ls /opt/
  - ./.travis/$TRAVIS_OS_NAME.before_install.sh

install:
  - curl -LsSf https://astral.sh/uv/install.sh | sh
  - uv python list
  - uv python find
  - uv python find --system
  - python --version
  - ./.travis/$TRAVIS_OS_NAME.install.sh
  # - pyenv install 3.9
  - uv python install 3.9
  - which python
  - python --version -VV
  - printenv | grep PY | sort
  - printenv | grep python | sort
  - printenv | grep py | sort
  - printenv | grep PATH | sort

before_script:
  - which python
  - uv python list
  - uv python find
  - uv python find --system
  - uv python dir
  - ls -la $(uv python dir)
  - uv python dir --bin
  - ls -la $(uv python dir --bin)
  - python --version -VV
  - python3 --version -VV
  # - python3.9 --version -VV
  - python3.10 --version -VV
  - pyenv rehash
  - pyenv
  - pyenv --version
  - pyenv version-origin
  - pyenv version-name
  - pyenv version-file
  - pyenv version
  - pyenv shell
  - pyenv prefix
  - pyenv shims
  - which python
  - which python3
  - which python3.10
  - uv python list
  - uv python find
  - uv python find --system
  - uv python dir
  - ls -la $(uv python dir)
  - uv python dir --bin
  - ls -la $(uv python dir --bin)
  - python --version -VV
  - python3 --version -VV
  - python3.10 --version -VV
  - python3.9 --version -VV
  - which python3.9
  # see https://github.com/astral-sh/uv/issues/6265

script:
  - ./.travis/$TRAVIS_OS_NAME.script.sh
